@using Service.Interfacies.Entities
@using WebApplication.Models
@using WebApplication.Models.AuthorModels
@using WebApplication.Models.BookModels
@using WebApplication.Models.ContentModels
@using WebApplication.Models.UserModels
@model WebApplication.Models.BookModels.BookPageModel

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="jumbotron">
    <div class="row">
        <div class="col-md-3 row" style="margin-right:5px">
            <div class="text-center">
                <img class="img-thumbnail" src="@Url.Action("GetImage", "Books", new {id = Model.ID})" alt="image"/>
            </div>
            
            <div class="" style="padding-top: 10px">
                <div id="like-progress-buttons">
                    @Html.Partial("_LikeProgressButtonsView",Model.Likes)
                </div>
                <div class="" style="padding-top: 10px">
                    @if (User.Identity.IsAuthenticated)
                    {
                        <div class="dropdown">
                            <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" type="button"><i class="glyphicon glyphicon-bookmark" aria-hidden="true"></i> Add book to collection <span class="caret"></span></button>
                            <ul class="dropdown-menu" role="menu">
                                <li class="dropdown-header">Already in</li>
                                @foreach (var clc in Model.CollectionsWithBook)
                                {
                                    <li><a href="@Url.Action("DeleteFromCollection", "CollectionBook", new {bookID = Model.ID, clID = clc.ID, returnUrl = Url.Action("Details", "Books", new {id = Model.ID})})">@clc.Name<span><i class="glyphicon glyphicon-remove"></i></span></a></li>
                                }
                                <li class="divider"></li>
                                <li class="dropdown-header">Add to</li>
                                @foreach (var clc in Model.CollectionWithoutBook)
                                {
                                    <li><a href="@Url.Action("Add", "CollectionBook", new {bookID = Model.ID, clID = clc.ID, returnUrl = Url.Action("Details", "Books", new {id = Model.ID})})">@clc.Name<span><i class="glyphicon glyphicon-saved"></i></span></a></li>
                                }
                            </ul>
                        </div>
                        <div class="" style="padding-top: 10px">
                            <div class="btn-group btn-group-sm btn-group-justified">
                                <a class="btn btn-default" href="@Url.Action("Edit", "Books", new {bookID = Model.ID})"><i class="glyphicon glyphicon-edit" aria-hidden="true"></i>Edit book</a>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="btn-group btn-group-sm btn-group-justified">
                            <a class="btn btn-info" href="@Url.Action("Login", "Login", new {returnUrl = Url.Action("Details", "Books", new {Id = Model.ID})})">Login to add books to the collection</a>
                        </div>
                    }
                </div>       
            </div>
        </div>
        <div class="col-md-9 row">
            <div class="panel panel-info">
                <div class="panel-heading">
                     <h2>@Model.Name</h2>
                </div>
                <div class="panel-body list-group">
                    <div class="list-group-item">
                        @Html.LabelFor(model => model.Authors, htmlAttributes: new {@class = "control-label col-md-4"})
                        @foreach (AuthorShortModel author in Model.Authors)
                        {
                            @Html.ActionLink(author.Name, "Details", "Author", new { id = author.ID }, htmlAttributes: new { @class = "control-label" })
                            @Html.Display(". ")
                        }
                    </div>
                    <div class="list-group-item">
                        @Html.LabelFor(model => model.PublishDate, htmlAttributes: new {@class = "control-label col-md-4"})
                        @Html.DisplayFor(model => model.PublishDate)
                    </div>
                    <div class="list-group-item">
                        @Html.LabelFor(model => model.AgeCategory, htmlAttributes: new {@class = "control-label col-md-4"})
                        @Html.DisplayFor(model => model.AgeCategory)
                    </div>
                    <div class="list-group-item">
                        @Html.LabelFor(model => model.Genres, htmlAttributes: new {@class = "control-label col-md-4"})
                        @foreach (GenreModel genre in Model.Genres)
                        {
                            @Html.ActionLink(genre.Name, "List", "Genre", new {id = genre.ID}, htmlAttributes: new {@class = "control-label"})
                            @Html.Display(". ")
                        }
                    </div>
                    <div class="list-group-item">
                        @Html.LabelFor(model => model.Tags, htmlAttributes: new {@class = "control-label col-md-4"})
                        @foreach (TagModel tag in Model.Tags)
                        {
                            @Html.ActionLink(tag.Name, "List", "Tag", new {id = tag.ID}, htmlAttributes: new {@class = "control-label"})
                            @Html.Display(", ")
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr />
    <div class="container">
        <div class="col-md-8">
            <div class="row">
                <div class=""></div>
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#comments">Comments</a></li>
                    <li><a data-toggle="tab" href="#contents">Contents</a></li>
                    <li><a data-toggle="tab" href="#reviews">Reviews</a></li>
                </ul>

                <div class="tab-content">
                    <div id="comments" class="tab-pane fade in active">
                        <h3>Comments</h3>
                        <div class="row">
                            @Html.Partial("_CommentListView", Model.Comments)
                        </div>
                        @using (Ajax.BeginForm("CreateComment", "Comment", new AjaxOptions()
                        {
                            HttpMethod = "POST",
                            InsertionMode = InsertionMode.Replace,
                            UpdateTargetId = "commentsContent",
                        }))
                        {
                            CommentModel comment = new CommentModel();
                            comment.Book = new BookShortModel() { ID = Model.ID };
                            comment.User = new UserShortModel();
                            comment.Text = "";
                            @Html.AntiForgeryToken()
                            <div class="form-horizontal">
                                @Html.ValidationSummary(true, "", new {@class = "text-danger"})
                                @Html.HiddenFor(e=>comment.Book.ID)
                                <div class="form-group">
                                    @Html.LabelFor(e => comment.Text, htmlAttributes: new {@class = "control-label col-md-2"})
                                    <div class="col-md-10">
                                        @Html.TextAreaFor(e => comment.Text, 10, 50, new {htmlAttributes = new {@class = "form-control"}})
                                        @Html.ValidationMessageFor(e => comment.Text, "", new {@class = "text-danger"})
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <input type="submit" value="Comment" class="btn btn-default"/>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div id="contents" class="tab-pane fade">
                        <h3>Contents</h3>
                        <div class="row">
                            @Html.Partial("_ContentListView", Model.Contents)
                            @foreach (var content in Model.Contents)
                            {
                                @Html.Partial("_ContentView", content)
                            }
                            @using (Ajax.BeginForm("CreateContent", "Comment", new AjaxOptions()
                            {
                                HttpMethod = "POST",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "contentsContent",
                            }))
                            {
                                ContentModel content = new ContentModel();
                                content.Book = new BookShortModel() {ID = Model.ID};
                                content.Text = "";
                                @Html.AntiForgeryToken()
                                <div class="form-horizontal">
                                    @Html.ValidationSummary(true, "", new {@class = "text-danger"})
                                    @Html.HiddenFor(e => content.Book.ID)
                                    <div class="form-group">
                                        @Html.LabelFor(e => content.Text, htmlAttributes: new {@class = "control-label col-md-2"})
                                        <div class="col-md-10">
                                            @Html.TextAreaFor(e => content.Text, 10, 50, new {htmlAttributes = new {@class = "form-control"}})
                                            @Html.ValidationMessageFor(e => content.Text, "", new {@class = "text-danger"})
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-2 col-md-10">
                                            <input type="submit" value="Add content" class="btn btn-default"/>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div id="reviews" class="tab-pane fade">
                        <h3>Reviews</h3>
                        <div class="row">
                            @Html.Partial("_ReviewListView",Model.Reviews)
                            @using (Ajax.BeginForm("CreateReview", "Comment", new AjaxOptions()
                            {
                                HttpMethod = "POST",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "reviewsContent",
                            }))
                            {
                                ReviewModel review = new ReviewModel();
                                review.Header = "";
                                review.Book = new BookShortModel() {ID = Model.ID};
                                review.Text = "";
                                review.Type = ReviewType.Negative;
                                @Html.AntiForgeryToken()
                                @Html.HiddenFor(e => review.Book.ID)
                                <div class="form-horizontal">
                                    @Html.ValidationSummary(true, "", new {@class = "text-danger"})
                                    <div class="form-group">
                                        @Html.LabelFor(e => review.Header, htmlAttributes: new {@class = "control-label col-md-2"})
                                        <div class="col-md-10">
                                            @Html.EditorFor(e => review.Header, new {htmlAttributes = new {@class = "form-control"}})
                                            @Html.ValidationMessageFor(e => review.Header, "", new {@class = "text-danger"})
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        @Html.LabelFor(e => review.Text, htmlAttributes: new {@class = "control-label col-md-2"})
                                        <div class="col-md-10">
                                            @Html.TextAreaFor(e => review.Text, 10, 50, new {htmlAttributes = new {@class = "form-control"}})
                                            @Html.ValidationMessageFor(e => review.Text, "", new {@class = "text-danger"})
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-2 col-md-10">
                                            <input type="submit" value="Add review" class="btn btn-default"/>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="row">

            </div>
        </div>
    </div>
</div>
